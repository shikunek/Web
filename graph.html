<html>
<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <meta name="google-signin-client_id" content="984038814608-l221clj0a3c05qaunenrm9oe9q3fvqif.apps.googleusercontent.com">
  <meta name="google-signin-cookiepolicy" content="single_host_origin">
  <meta name="google-signin-scope" content="profile email">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

<div class="topnav">
  <div class='leftLink' id='leftBar'>
    <a href="#" id='mainPage'>Main</a>  
    <a href="#" id='myGraphs' style="display: none">My projects</a>  
  </div>

  <div class='rightLink'>
    <a href="#" style="width:auto;" id="login" onclick="document.getElementById('myModal').style.display='block'">Login</a>
  </div>

<!--   <div id="id01" class="modal">
  
    <form class="modal-content animate">
      <div class="imgcontainer">
        <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>     
      </div>

      <div class="container">
        <label for="uname"><b>Username</b></label>
        <input type="text" placeholder="Enter Username" name="uname" id="email" required>

        <label for="psw"><b>Password</b></label>
        <input type="password" placeholder="Enter Password" name="psw" id="password" required>
          
        <button type="submit" id="signIn" onclick="signInE()" type="button">Log In</button>
        <label>
          <input type="checkbox" checked="checked" name="remember"> Remember me
        </label>
        <div class="g-signin2" data-onsuccess="onSignIn" width="320px"></div>
        <button type="submit" id="signOut" onclick="signOut()">Sign Out</button>
      </div>
    </form>
  </div> -->

  <div class="container">

  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
      <div class="imgcontainer">
        <span onclick="document.getElementById('myModal').style.display='none'" class="close" title="Close Modal">&times;</span>
      </div>
        <div class="modal-body" style="padding:40px 50px;">
          <!-- <form role="form"> -->
            <div class="form-group">
              <label for="usrname"><span class="glyphicon glyphicon-user"></span> Username</label>
              <input type="text" class="form-control" id="email" placeholder="Enter email">
            </div>
            <div class="form-group">
              <label for="psw"><span class="glyphicon glyphicon-eye-open"></span> Password</label>
              <input type="password" class="form-control" id="password" placeholder="Enter password">
            </div>
            <div class="checkbox">
              <label><input type="checkbox" value="" checked>Remember me</label>
            </div>
              <button type="submit" onclick="signIn()" class="btn btn-success btn-block"><span class="glyphicon glyphicon-off"></span> Login</button>
              <button type="submit" onclick="signOut()" id="mySignOut" class="btn btn-success btn-block"><span class="glyphicon glyphicon-off"></span> Sign Out</button>
          <!-- </form> -->
        </div>
      </div>
      
    </div>
  </div> 
</div>
  
</div>
<!-- <header id="header">
  <div class="inner">
    <nav id="menubar">
    <ul id="menu">
        <li class="dropdown"><a href="#">Company</a></li>
        <li class="selected dropdown"><a href="#">Products</a></li>
        <li class="dropdown"><a href="#">News</a></li>
        <li class="dropdown"><a href="#">Downloads</a></li>
        <li><a href="#">Contact</a></li>
    </ul>
    </nav>
  </div>
</header> -->


<!-- <section id="graph">
  <img src="graph.png" alt="Browser GUI" width="600">

</section> -->

<!-- <button id="addData" onclick="tryToDisplayTimeline()">Add Data</button> -->

<!-- <canvas id="myChart" width="400" height="400"></canvas> -->
<!-- <div class="chartWrapper" >
        <div class="chartAreaWrapper" style=" float: left; width: 600px; overflow:scroll; ">
            <canvas id="myChart" height="100" ></canvas>
        </div>
        <canvas id="myChartAxis" height="100" width="300"></canvas>
    </div> -->
    <!-- <canvas id="myImg" src="images/ui-icons_555555_256x240.png" alt="Trolltunga, Norway" width="300" height="200"> -->
<!-- <div id="myModal" class="modal">
  <span class="close">&times;</span>
  <canvas class="modal-content" id="img01">
  <div id="caption"></div>
</div> -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<script src="https://apis.google.com/js/platform.js" async defer></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="basicFunction.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-database.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>



<script type="text/javascript">


    var actualUser = null;
    var numDays = 0;
    var leftDay = 0;
    var numShownDays = 10;
    var firstDayOfWeek = 0;
    var firstDayShown = null; // Date
    // var yValues = [];

 var config = {
    apiKey: "AIzaSyAR7L3KrsOWXYqu0HMcM85EOBPKWSOF9t0",
    authDomain: "testapp-5cce5.firebaseapp.com",
    databaseURL: "https://testapp-5cce5.firebaseio.com",
    projectId: "testapp-5cce5",
    storageBucket: "testapp-5cce5.appspot.com",
    messagingSenderId: "984038814608"
  };
  firebase.initializeApp(config);


  firebase.auth().onAuthStateChanged(user => {
        if(user) {
          console.log(user.email);
          document.getElementById('myGraphs').style.display = 'block';   
          // KDYZ JE UZIVATEL PRIHLASEN, TAK SE VYKRESLI GRAFY
          showGraph(user);       
        }
        else{
          console.log('Nikdo'); 
          // window.location.href = 'graph.html'; 
        }
      });

  function signIn() {

      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;

      if (firebase.auth().currentUser) {
        // [START signout]
        firebase.auth().signOut();
        // ODDELANI VSECH GRAFU A ZNOVU NACTENI
        $( ".chartArea" ).remove();
        $( "#mainDiv" ).remove();

        console.log('Sign Out Succ');
        firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // [START_EXCLUDE]
          if (errorCode === 'auth/wrong-password') {
            alert('Wrong password.');
          } else {
            alert(errorMessage);
          }
          console.log(error);
          // document.getElementById('quickstart-sign-in').disabled = false;
          // [END_EXCLUDE]
        });
        // [END signout]
      } else {
        
        if (email.length < 4) {
          alert('Please enter an email address.');
          return;
        }
        if (password.length < 4) {
          alert('Please enter a password.');
          return;
        }
        console.log('Novy');
        // Sign in with email and pass.
        // [START authwithemail]
        firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // [START_EXCLUDE]
          if (errorCode === 'auth/wrong-password') {
            alert('Wrong password.');
          } else {
            alert(errorMessage);
          }
          console.log(error);
          // document.getElementById('quickstart-sign-in').disabled = false;
          // [END_EXCLUDE]
        });
        // [END authwithemail]
      }
      document.getElementById('myModal').style.display='none';
      // document.getElementById('quickstart-sign-in').disabled = true;
    }

    function signOut(){
      firebase.auth().signOut().then(function() {
          // Sign-out successful.
          console.log('Sign Out');
          document.getElementById('myModal').style.display='none';
          window.location.href = 'index.html'; 
        }).catch(function(error) {
          // An error happened.
        });
    }


  // Get the modal
  // var modal = document.getElementById('id01');



  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
      if (event.target == myModal) {
          myModal.style.display = "none";
      }
  }

  var graphs = document.getElementById('myGraphs');
  graphs.onclick = function(event){
      window.location.href = 'graph.html'; //After successful login, user will be redirected to home.html    
  }

  var main = document.getElementById('mainPage');
  main.onclick = function(event){
      window.location.href = 'index.html';
  }


 
    /**
     * Check that the given Google user is equals to the given Firebase user.
     */
    // [START checksameuser]
    function isUserEqual(googleUser, firebaseUser) {
      if (firebaseUser) {
        var providerData = firebaseUser.providerData;
        for (var i = 0; i < providerData.length; i++) {
          if (providerData[i].providerId === firebase.auth.GoogleAuthProvider.PROVIDER_ID &&
              providerData[i].uid === googleUser.getBasicProfile().getId()) {
            // We don't need to reauth the Firebase connection.
            return true;
          }
        }
      }
      return false;
    }


function showGraph(user)
  {
      var userGraphsRef = firebase.database().ref('Uzivatel/' + user.uid + '/Projects');
      
      var mainDiv = document.createElement("div");    
      mainDiv.id = 'mainDiv';
      mainDiv.setAttribute("style", "text-align: center;width:auto;margin:0 auto");
      
      
      userGraphsRef.on('value', function(projects) 
      {       
          var i = 0;             
          projects.forEach(function(project)
          {

              var projectGraphRef = firebase.database().ref('Projects/' + project.key);  
              
              // console.log(project.val());
              // SEM DAT PRIDAVANI ELEMENTU S GRAFEM    
              
              // if (i != 0) {return;};
              i++;

              var myGraph = {
                  type: 'line',
                  data: {
                      labels: [],
                      datasets: [
                      ]
                  },
                  width: 500,
                  height: 400,
                  options: {
                      responsive: true,
                      legend: {
                          display: true,
                          
                      },
                      gridLines: {
                        display: false,
                        drawBorder: true,
                        drawOnChartArea: false,
                      },
                      title:{
                          display:true,
                          text: project.val().projectName
                      },
                      tooltips: {
                          callbacks: {
                              labelColor: function(tooltipItem, chart) {
                                  return {
                                      borderColor: 'rgb(255, 0, 0)',
                                      backgroundColor: 'rgb(255, 0, 0)'
                                  }
                              },
                              labelTextColor:function(tooltipItem, chart){
                                  return '#543453';
                              },
                              label: function(tooltipItems, data) { 
                                  return data.datasets[tooltipItems.datasetIndex].label;
                                  // return tooltipItems.yLabel;
                              }

                          }
                      },
                      hover: {
                          mode: 'nearest',
                          intersect: true
                      },
                      scales: {
                          xAxes: [{
                              display: true,
                              scaleLabel: {
                                  display: true,
                                  labelString: 'Time'
                              },
                              gridLines: {
                                  display:false
                              }
                          }],
                          yAxes: [{
                              display: true,
                              ticks: {
                                beginAtZero: true,
                                max: 1,
                                min: -1

                              },
                              gridLines: {
                                  display:false
                              },
                              scaleLabel: {
                                  display: true,
                                  labelString: 'Progress'
                              }
                          }]
                      },
                      animation:{

                          onComplete: function(animation) {
                          
                      }
                    }
                  
                    }
                  };
             
  

              // Get the image and insert it inside the modal - use its "alt" text as a caption
              // var img = document.getElementById('myImg');
               // var div = document.createElement("div");
              var canv = document.createElement('canvas');
              canv.id = project.key;
              canv.width = 500;
              canv.height = 400;
              
              // canv.setAttribute('height', '400');
              // canv.setAttribute("style", "border: 1px solid red");
              // canv.setAttribute('width', 'inherit');
              
              // console.log(graf);
              var chartArea = document.createElement("div");
              chartArea.className = 'chartArea';
              chartArea.id = 'chartAr';
              chartArea.appendChild(canv);
              var isBig = false;
              // chartArea.width = 400;
              // float: left; width: 600px; overflow:scroll;
              chartArea.setAttribute("style", " width: 500; height: 400;display:inline-block;");

              
              var graf = new Chart(canv, myGraph);
              // var captionText = document.getElementById("caption");
              chartArea.onclick = function(){
                  // graf = new Chart(canv, myGraph);
                  // modal.style.display = "block";
                  document.getElementById(project.key).remove();
                  var canv = document.createElement('canvas');
                  canv.id = project.key;
                
                  if (!isBig) {
                      chartArea.style.width = '100%';
                      chartArea.style.height = 550;
                      canv.style.width = 1200
                      chartArea.style.marginLeft = '0';
                      chartArea.style.marginRight = '0';
                      canv.height = 400;
                      isBig = true;
                  }
                  else
                  {
                      canv.setAttribute('width', 500);
                      chartArea.style.width = 500;
                      chartArea.style.height = 400;
                      // chartArea.style.marginLeft = '5%';
                      // chartArea.style.marginRight = '5%';
                      canv.height = 400;
                      isBig = false;
                  }
                  
                  
                
                  chartArea.appendChild(canv);
              
                  graf = new Chart(canv, myGraph);
                  // canvModal.drawImage(canv, 0, 0, 300, 300, 0, 0, 300, 300)
                  
                  // canv.style.width = 1200;
                  // console.log(canv);
                  // console.log(canvModal);
                  // canvModal.width = canv.width;
                  // canvModal.height = canv.height;
                  // this.style.width = 1200;
                  
                  // chartArea.style.width = 1200;
                  // graf.update();
                  // graf.update();
                  // canvModal.width = 1200;
                  // canvModal.height = 1000;
                  // modal.appendChild(canv);
                  // modalImg.src = this.src;
                  // captionText.innerHTML = this.alt;
              }
              // var span = document.getElementsByClassName("close")[0];

              // // When the user clicks on <span> (x), close the modal
              // span.onclick = function() { 
              //     modal.style.display = "none";
              // }
              

              // chartArea.scrollTo(100,100);

              
              
              // var modalGraf = new Chart(canvModal, myGraph);
              mainDiv.appendChild(chartArea);      
              

              projectGraphRef.on('value', function(projectUser) 
              {
                    var iUser = 0;                    
                    var mostDays = 0;
                    var configLabels = false;                  
                    projectUser.forEach(function(childSnapshot) 
                    {
                      var childKey = childSnapshot.key;
                      var userRef = firebase.database().ref('Uzivatel/' + childKey);
                      var email = null;
                      userRef.on('value', function(user)
                      { 

                          // KTERY UZIVATEL MA NEJVICE DAT
                          if (childSnapshot.numChildren() > mostDays) {
                            console.log(project.val().projectName);
                              mostDays = childSnapshot.numChildren();
                              configLabels = true;
                          };
                          if (user.val() != null) {
                              email = user.val().email;
                          };
                              var childData = childSnapshot.val();

                          if (childKey == "projectName" || childKey == "Ending") 
                          {

                            return;

                          };
                          // myGraph.data.labels = ["asd","ad"];
                          myGraph = someGraphSetting(myGraph, iUser, childSnapshot, configLabels, email);
                          
                          configLabels = false;
                          graf.update();
                          // modalGraf.update();

                          iUser++; 


                      });
                     
                      
                    });
                    // console.log(myGraph.data.datasets);
              });
              

              
          });

          
          
      });
      document.body.appendChild(mainDiv);
  }

 

  

  function someGraphSetting(myGraph, usersNumber, usersProjectValues, configLabels, email)
  {

    var yValues = [];

    // console.log(email);
    
    if (configLabels) {
      myGraph.data.labels = [];
    };
    // console.log(myGraph);

    var yValuesMiss = [];
    var y = 0;
    var firstEntry = {x: 0, y: y}; 
    // yValues.push(firstEntry); // first entry is 0

    // console.log(configLabels);
    
    var lastEntry = {x: 0, y: y}; 
    var lastMissEntry = null;
        var i = 0;
        var preReport = true; // solution for late addition of user and his missed reports
        var lastMiss = false;
        var thisMiss = false;;
        var date;
        // SimpleDateFormat dateFormatter = new SimpleDateFormat("yyyy-MM-dd", Locale.ENGLISH);
        // Calendar actDate = Calendar.getInstance();
        var dataset = {
                      label: "",
                      backgroundColor: null,
                      borderColor: null,
                      data: [
                      ],
                      fill: false
              
                    }
          // console.log("Prvni");
          
          // PRVNI PRVEK JE ZVLAST                    
          // dataset.backgroundColor = setDatasetColor(dataset, usersNumber);
          // myGraph.data.labels.push("prvni");
          // dataset.label = usersNumber;

          // dataset.data = yValues.slice();
          
          // if (usersNumber == 1) 
          // {
          //     // return;
          //           dataset.backgroundColor = 'blue';
          //           dataset.borderColor = 'blue';
          // };      

      var previousValue = lastEntry;
      var changeLabels = false;
      // console.log(usersProjectValues.length);
       if (myGraph.data.labels.length < usersProjectValues.length) 
        {
              changeLabels = true;
              myGraph.data.labels = [];
        };
      
      // console.log(usersProjectValues.numChildren());
      var lastKey = null;

      usersProjectValues.forEach(function(usersValue)
      {        
             // dataset = {
             //            label: usersNumber,
             //            backgroundColor: null,
             //            borderColor: null,
             //            data: [
             //            ],
             //            fill: false
                
             //          };

              if (usersValue == null) {
                  // return datasets;
              };
              // console.log(usersValue.key);
              var smile = usersValue.val().sendValue;
              var key = usersValue.key;
              lastKey = key;
              
              date = new Date(key);
                        
              
                  
              thisMiss = smile < -1;
              if (i == 1 && (firstDayShown == null || date < firstDayShown))
              {
                  firstDayShown = date;
                  // DAY_OF_WEEK start 1 = Su
                  // console.log(date.getDay());
                  firstDayOfWeek = (date.getDay()+ 5) % 7;
              };
              if (thisMiss) 
              { // just add new value to miss dataset
                  if (!lastMiss)
                  {
                    //TADY ZMENA, PROTOZE SE DAVALA HODNOTA, KTERA JIZ BYLA PRIDANA
                      // yValuesMiss.push(lastEntry);
                      // console.log("1");
                      // console.log(yValuesMiss);
                  }
                      
                  y = translateEntry(y, -1);
                  yValuesMiss.push({x: i, y: y});
                  lastMissEntry = {x: i, y: y};
                  previousValue = lastMissEntry;
                  // console.log("2");
                  // console.log(yValuesMiss);              
              }
              else
              { // !thisMiss && !lastMiss => just add new value to dataset
                  if (lastMiss)
                  {
           
                      // console.log("3");
                      // console.log(yValuesMiss);
                      // console.log(yValues);

                      dataset.backgroundColor = setDatasetColor(dataset, usersNumber);
                      dataset.data = dataset.data.concat(yValues);

                      // myGraph.data.datasets.push(dataset);
                      // console.log(dataset);
                      dataset.data = dataset.data.concat(yValuesMiss); 
                      
                      // myGraph.data.datasets.push(dataset);
                      // console.log(dataset.data);
                      
                      yValues = [];
                      // entry to connect last miss and first base entry in base color
                      //TADY ZMENA, PROTOZE SE DAVALA HODNOTA, KTERA JIZ BYLA PRIDANA
                      // yValues.push(lastMissEntry);
                      yValuesMiss = [];
                  }

                  y = translateEntry(y, smile);
                  yValues.push({x: i, y: y});
                  previousValue = {x: i, y: y};
                  // console.log("4");
                  // console.log(yValues);
                  lastEntry = {x: i, y: y};
              }
              // console.log(previousValue);
              lastMiss = thisMiss;
              i++;

              if (configLabels) 
              {               
                  if (i % 2 != 0) {
                      lastKey = usersValue.key;
                      myGraph.data.labels.push(usersValue.key);    
                  } 
                  else
                  {
                      myGraph.data.labels.push('');
                  }
                  
              };
      });
        // myGraph.data.labels.push('today');
              
        if (configLabels) {

            var isLastDate = myGraph.data.labels[myGraph.data.labels.length -1] != '';
            var date = new Date(lastKey);
            
            var today = new Date();

            while(date < today){
               // console.log(date); // ISO Date format          

                if (isLastDate) {
                    isLastDate = false;
                    myGraph.data.labels.push('');
                    
                }
                else
                {                    
                    // i.setDate(i);           
                    // console.log(newDate.toISOString().substring(0, 10));
                    myGraph.data.labels.push(date.toISOString().substring(0, 10));  
                    isLastDate = true;   
                }

               var newDate = date.setDate(date.getDate() + 1);
               date = new Date(newDate);
            }

            // for(var i = date.getDate() + 1; i <= today.getDate() ; i = i + 1)
            // {
                
                
            //     // var newDate = i
            //     // i.setDate();   
                

            //     // newDate = i;
            //     // return;
            // }
            
            // if (lastDate != '') {
                // console.log(lastDate);
                
            // };
            
        };

        if (usersNumber == 0) 
        {
            usersNumber = false;
                          
        };
        // if (i-1 > numDays)
        // {
        //     numDays = i-1;
        // }
        if (yValues.length > 0)
        { 
          
            // console.log("5");
            dataset.backgroundColor = setDatasetColor(dataset, usersNumber);

            dataset.data = dataset.data.concat(yValues); 
            // myGraph.data.datasets.push(dataset);
            // console.log(yValues);
        }

        if (yValuesMiss.length > 0)
        {        
            dataset.backgroundColor = setDatasetColor(dataset, usersNumber);
            // yValuesMiss.unshift(previousValue);
            yValuesMiss.push(previousValue);
            dataset.data = dataset.data.concat(yValuesMiss); 
            // dataset.data = yValuesMiss; 
            // myGraph.data.datasets.push(dataset);
            // dataset.data = [];
            
            console.log("6");
        }
        if (email != null) {
            dataset.label = email;
          };
          // console.log(myGraph.data);

        myGraph.data.datasets.push(dataset);
        return myGraph;
                
  }


  function setDatasetColor(dataset, usersNumber)
  {
      switch (usersNumber)
        {
            case 0: // Base_Red: #e57373, Miss_Red: #ffcdd2
                    dataset.backgroundColor = "rgb(229, 115, 115)";
                    dataset.borderColor =  "rgb(229, 115, 115)";
                    // lineDataSet.setColor(Color.argb(255, 229, 115, 115));
                    // lineDataSet.setCircleColor(Color.argb(255, 229, 115, 115));
                break;
            case 1: // Base_Light-Blue: #4fc3f7, Miss_Light-Blue: #b3e5fc
                    dataset.backgroundColor = "rgb(79, 195, 247)"; 
                    dataset.borderColor = "rgb(79, 195, 247)"; 
                    // lineDataSet.setColor(Color.argb(255, 79, 195, 247));
                    // lineDataSet.setCircleColor(Color.argb(255, 79, 195, 247));
                break;
            case 2: // Base_Green: #81c784, Miss_Green: #c8e6c9
                    dataset.backgroundColor = "rgb(129, 199, 132)"; 
                    dataset.borderColor = "rgb(129, 199, 132)"; 
                    // lineDataSet.setColor(Color.argb(255, 129, 199, 132));
                    // lineDataSet.setCircleColor(Color.argb(255, 129, 199, 132));
                break;
            case 3: // Base_Purple: #ba68c8, Miss_Purple: #e1bee7
                    dataset.backgroundColor = "rgb(186, 104, 200)"; 
                    dataset.borderColor = "rgb(186, 104, 200)"; 
                    // lineDataSet.setColor(Color.argb(255, 186, 104, 200));
                    // lineDataSet.setCircleColor(Color.argb(255, 186, 104, 200));
                break;
            case 4:
                    dataset.backgroundColor = "rgb(249, 249, 6)"; 
                    dataset.borderColor = "rgb(249, 249, 6)"; 
                // lineDataSet.setColor(Color.argb(255, 249, 249, 6));
                // lineDataSet.setCircleColor(Color.argb(255, 249, 249, 6));
                break;

            case 5:
                    dataset.backgroundColor = "rgb(255, 119, 250)"; 
                    dataset.borderColor = "rgb(255, 119, 250)"; 
                // lineDataSet.setColor(Color.argb(255, 255, 119, 250));
                // lineDataSet.setCircleColor(Color.argb(255, 255, 119, 250));
                break;   
            default:
                    dataset.backgroundColor = "rgb(229, 115, 115)"; 
                    dataset.borderColor = "rgb(229, 115, 115)"; 
                    // lineDataSet.setColor(Color.BLUE);
                    // lineDataSet.setCircleColor(Color.BLUE);
                break;
        }
        return dataset.backgroundColor;
  }
  

  function translateEntry(old_y, smile)
  {
      var new_y = 0;
        var x_delta;
        var shiftPar = 0.4; // the smaller the number, the slower the change
        if (old_y >= 1 || old_y <= -1) { // old value is outside of bounds
            throw "Y-value not within bounds (-1,1)";
        }
        else if (old_y > 0) {
            switch(smile) {
                case  1: // function (1)
                    x_delta = Math.tan(old_y * (Math.PI / 2));
                    x_delta = shiftPar + x_delta;
                    new_y = (Math.atan(x_delta)/(Math.PI / 2));
                    // console.log("F1", "y_old: " + old_y + ", smile: " + smile + ",\nx_d: " + x_delta + ", new_y: " + new_y + "\n");
                    break;
                case  0: // function (4)
                    x_delta = (-1 * (Math.tan(old_y * (Math.PI / 2) - (Math.PI / 2))));
                    x_delta = shiftPar + x_delta;
                    new_y = (Math.atan(-1 * x_delta) / (Math.PI / 2) + 1);
                    // console.log("F4", "y_old: " + old_y + ", smile: " + smile + ",\nx_d: " + x_delta + ", new_y: " + new_y + "\n");
                    break;
                case -1: // function (6)
                    x_delta = (-1 * (Math.tan(old_y * (Math.PI / 4) - (Math.PI / 4))));
                    x_delta = shiftPar + x_delta;
                    new_y = (2 * (Math.atan(-1 * x_delta) / (Math.PI / 2)) + 1);
                    // console.log("F6", "y_old: " + old_y + ", smile: " + smile + ",\nx_d: " + x_delta + ", new_y: " + new_y + "\n");
                    break;
                default:
                    throw "Smile not within bounds [-1,0,1]";
            }
        }
        else if (old_y <0) {
            switch(smile) {
                case  1: // function (5)
                    x_delta = Math.tan(old_y * (Math.PI / 4) + (Math.PI / 4));
                    x_delta = shiftPar + x_delta;
                    new_y = (2 * (Math.atan(x_delta)/(Math.PI / 2)) - 1);
                    // console.log("F5", "y_old: " + old_y + ", smile: " + smile + ",\nx_d: " + x_delta + ", new_y: " + new_y + "\n");
                    break;
                case  0: // function (3)
                    x_delta = Math.tan(old_y * (Math.PI / 2) + (Math.PI / 2));
                    x_delta = shiftPar + x_delta;
                    new_y = (Math.atan(x_delta)/(Math.PI / 2) - 1);
                    // console.log("F3", "y_old: " + old_y + ", smile: " + smile + ",\nx_d: " + x_delta + ", new_y: " + new_y + "\n");
                    break;
                case -1: // function (2)
                    x_delta = (-1 * (Math.tan(old_y * (Math.PI / 2))));
                    x_delta = shiftPar + x_delta;
                    new_y = (Math.atan(-1 * x_delta) / (Math.PI / 2));
                    // console.log("F2", "y_old: " + old_y + ", smile: " + smile + ",\nx_d: " + x_delta + ", new_y: " + new_y + "\n");
                    break;
                default:
                    throw "Smile not within bounds [-1,0,1]";
            }
        }
        else { // old_y == 0
            switch(smile) {
                case  1: // function (1)
                    x_delta = Math.tan(old_y * (Math.PI / 2));
                    x_delta = shiftPar + x_delta;
                    new_y = (Math.atan(x_delta) / (Math.PI / 2));
                    // console.log("F1", "y_old: " + old_y + ", smile: " + smile + ",\nx_d: " + x_delta + ", new_y: " + new_y + "\n");
                    break;
                case  0:
                    break;
                case -1: // function (2)
                    x_delta = (-1 * (Math.tan(old_y * (Math.PI / 2))));
                    x_delta = shiftPar + x_delta;
                    new_y = (Math.atan(-1 * x_delta) / (Math.PI / 2));
                    // console.log("F2", "y_old: " + old_y + ", smile: " + smile + ",\nx_d: " + x_delta + ", new_y: " + new_y + "\n");
                    break;
                default:
                    throw "Smile not within bounds [-1,0,1]";
            }
        }

        return new_y;
  }




  //   firebase.database().ref('/Progress/Petr').once('value', function(snapshot) {
//   snapshot.forEach(function(childSnapshot) {
//     if (childSnapshot.key != 'LastAdded') {
//           var childData = childSnapshot.val().Y;
//           myGraph.data.labels.push(childSnapshot.key);
//           myGraph.data.datasets.forEach((dataset) => {
//           dataset.data.push(childData);
//           });
          
//     };
//     window.myLine.update();
//     // ...
//   });
  
// });

  // document.getElementById('addData').addEventListener('click', function() {
  //           if (myGraph.data.datasets.length > 0) {
  //               var month = MONTHS[config.data.labels.length % MONTHS.length];
  //               myGraph.data.labels.push(month);

  //               myGraph.data.datasets.forEach(function(dataset) {
  //                   dataset.data.push(5);
  //               });

  //               window.myLine.update();
  //           }
  //       });

  var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

 


    // var MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    // var config = {
    //   type: 'line',
    //   data: {
    //     labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
    //     datasets: [{
    //       label: 'My First dataset',
    //       backgroundColor: 'red',
    //       borderColor: 'red',
    //       data: [1,2,3,4,5,6,2
    //       ],
    //       fill: false,
    //     }, {
    //       label: 'My Second dataset',
    //       fill: false,
    //       backgroundColor: 'red',
    //       borderColor: 'red',
    //       data: [
    //         2,3,4,5,6,7,8
    //       ],
    //     }]
    //   },
    //   options: {
    //     responsive: true,
    //     title: {
    //       display: true,
    //       text: 'Chart.js Line Chart'
    //     },
    //     tooltips: {
    //       mode: 'index',
    //       intersect: false,
    //     },
    //     hover: {
    //       mode: 'nearest',
    //       intersect: true
    //     },
    //     scales: {
    //       xAxes: [{
    //         display: true,
    //         scaleLabel: {
    //           display: true,
    //           labelString: 'Month'
    //         }
    //       }],
    //       yAxes: [{
    //         display: true,
    //         scaleLabel: {
    //           display: true,
    //           labelString: 'Value'
    //         }
    //       }]
    //     }
    //   }
    // };

    // window.onload = function() {
    //   var ctx = document.getElementById('canvas').getContext('2d');
    //   window.myLine = new Chart(ctx, config);
    // };

    // document.getElementById('randomizeData').addEventListener('click', function() {
    //   config.data.datasets.forEach(function(dataset) {
    //     dataset.data = dataset.data.map(function() {
    //       return randomScalingFactor();
    //     });

    //   });

    //   window.myLine.update();
    // });

    // var colorNames = Object.keys(window.chartColors);
    // document.getElementById('addDataset').addEventListener('click', function() {
    //   var colorName = colorNames[config.data.datasets.length % colorNames.length];
    //   var newColor = window.chartColors[colorName];
    //   var newDataset = {
    //     label: 'Dataset ' + config.data.datasets.length,
    //     backgroundColor: newColor,
    //     borderColor: newColor,
    //     data: [],
    //     fill: false
    //   };

    //   for (var index = 0; index < config.data.labels.length; ++index) {
    //     newDataset.data.push(randomScalingFactor());
    //   }

    //   config.data.datasets.push(newDataset);
    //   window.myLine.update();
    // });

    // document.getElementById('addData').addEventListener('click', function() {
    //   if (config.data.datasets.length > 0) {
    //     var month = MONTHS[config.data.labels.length % MONTHS.length];
    //     config.data.labels.push(month);

    //     config.data.datasets.forEach(function(dataset) {
    //       dataset.data.push(randomScalingFactor());
    //     });

    //     window.myLine.update();
    //   }
    // });


    //   window.myLine.update();
    // });
  
   // function tryToDisplayTimeline(){
    // add date and value
    // console.log(myGraph.data.datasets[0].label);
    // if (myGraph.data.labels.length == 0) {
        // n =  new Date();
        //     y = n.getFullYear();
        //     m = n.getMonth() + 1;
        //     d = n.getDate();
        //     var now = d + "." + m + "." + y;
        //     myGraph.data.labels.push(now);
        //     myGraph.data.datasets.forEach((dataset) => {
        //         dataset.data.push(2);

        //   });
        //     window.myLine.update(); 
    // }
    // else
    // {
    //   var lastDate = myGraph.data.labels[myGraph.data.labels.length - 1];   
    //       var res = lastDate.split(".");
    //       var newDay = parseInt(res[0]) + 1;
    //       var newDate = newDay + "." + res[1] + "." + res[2];
    //       console.log(myGraph.data.datasets[1].label);
    //       var petersLine = myGraph.data.datasets[0];
    //       var jirkasLine = myGraph.data.datasets[1];
    //       myGraph.data.labels.push(newDate);

    //           // var new_X = parseInt($('input[name="gender"]:checked').val()) + 
    //           // parseInt(petersLine.data[petersLine.data.length - 1]);
    //           if (myGraph.data.labels.length > 5) {
    //           myGraph.data.labels.shift();
    //           petersLine.data.shift();
    //           // jirkasLine.data.shift();
    //           };
    //           petersLine.data.push(5);
    //           // jirkasLine.data.push(0);         
    //           window.myLine.update(); 
                  
    // }
  // }

 // var graphs = document.getElementById('myGraphs');
  // graphs.onclick = function(event){
  //     firebase.auth().onAuthStateChanged(user => {
  //       if(user) {
  //         window.location = 'graph.html'; //After successful login, user will be redirected to home.html
  //       }
  //     });
  // }

  // var main = document.getElementById('mainPage');
  // main.onclick = function(event){
  //     window.location = 'index.html';
  // }


  // window.onload = function(){
  //     ///MOZNA DELA PROBLEM, ZE JE VOLANO VZDY
  //   firebase.auth().onAuthStateChanged(function(user) {
  //   if (user) {
  //     // User is signed in.
  //     console.log(user.email);
  //     actualUser = user;
  //     showGraph(user);
  //   } else {
  //     // No user is signed in.
  //     console.log("Nikdo");    
  //   }
  // });
  // }
  



    // function mySignOut() {
    //   firebase.auth().signOut().then(function() {
    //     // Sign-out successful.
    //       console.log('Povedlo se.');
    //       document.getElementById('id01').style.display = 'none';
    //       // window.location.href = 'index.html';
    //     }).catch(function(error) {
    //       // An error happened.
    //       console.log('Neco je spatne.');
    //     });;  
    //     //Handle Account Status
    //     // firebase.auth().onAuthStateChanged(user => {
    //     //   if(!user) {
    //     //     console.log('Get out.');
    //     //     window.location.href = 'index.html'; //After successful login, user will be redirected to home.html
    //     //   }
    //     // });

    

    // }

    // function signUp() {

    //  var username = document.getElementById("email").value;
    //  var password = document.getElementById("psw").value;
    //  firebase.auth().createUserWithEmailAndPassword(username, password).catch(function(error) {
    //     // Handle Errors here.
    //     var errorCode = error.code;
    //     var errorMessage = error.message;
    //     // [START_EXCLUDE]
    //     if (errorCode == 'auth/weak-password') {
    //       alert('The password is too weak.');
    //     } else {
    //       alert(errorMessage);
    //     }
    //     console.log(error);
    //     // [END_EXCLUDE]
    //   });

    //        //Handle Account Status
    //   firebase.auth().onAuthStateChanged(user => {
    //     if(user) {
    //       window.location = 'index.html'; //After successful login, user will be redirected to home.html
    //     }
    //   });
    
  // }

  // function login() {

  //     document.getElementById('id01').style.display='none';
  //     if (firebase.auth().currentUser) {
  //       // [START signout]
  //       console.log(firebase.auth().currentUser.email);
  //       // firebase.auth().signOut();
  //       // [END signout]
  //     }
  //     // else 
  //     // {
  //       var email = document.getElementById('email').value;
  //       var password = document.getElementById('psw').value;
  //       if (email.length < 4) {
  //         alert('Please enter an email address.');
  //         return;
  //       }
  //       if (password.length < 4) {
  //         alert('Please enter a password.');
  //         return;
  //       }
  //       console.log("Nove prihlaseni");
  //       console.log(email);
  //       console.log(password);
  //       // Sign in with email and pass.
  //       // [START authwithemail]
  //       var result = firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
  //         // Handle Errors here.
  //         var errorCode = error.code;
  //         var errorMessage = error.message;
  //         // [START_EXCLUDE]
  //         if (errorCode === 'auth/wrong-password') {
  //           alert('Wrong password.');
  //         } 
  //         else if (errorCode === 'auth/invalid-email') {
  //           alert('invalid-email.');
  //         } 
  //         else if (errorCode === 'auth/user-disabled') {
  //           alert('user-disabled.');
  //         } 
  //         else if (errorCode === 'auth/user-not-found') {
  //           alert('user-not-found.');
  //         } 
  //         else {
  //           console.log("Spatne prihlasovani");
  //           alert(errorMessage);
  //         }
  //         console.log(error);
          

  //         // [END_EXCLUDE]
  //       });
        
        
        // [END authwithemail]
      // }
      
      //Handle Account Status
      // firebase.auth().onAuthStateChanged(user => {
      //   if(user) {
      //     window.location = 'graph.html'; //After successful login, user will be redirected to home.html
      //   }
      //   else{
      //     window.location = 'index.html';
      //   }
      // });
      
    // }

    // function onSignIn(googleUser) {
    //   console.log('Google Auth Response', googleUser);
    //   // We need to register an Observer on Firebase Auth to make sure auth is initialized.
    //   var unsubscribe = firebase.auth().onAuthStateChanged(function(firebaseUser) {
    //     unsubscribe();
    //     // Check if we are already signed-in Firebase with the correct user.
    //     if (!isUserEqual(googleUser, firebaseUser)) {
    //       // Build Firebase credential with the Google ID token.
    //       // [START googlecredential]
    //       var credential = firebase.auth.GoogleAuthProvider.credential(
    //           googleUser.getAuthResponse().id_token);
    //       // [END googlecredential]
    //       // Sign in with credential from the Google user.
    //       // [START authwithcred]
    //       firebase.auth().signInWithCredential(credential).catch(function(error) {
    //         // Handle Errors here.
    //         var errorCode = error.code;
    //         var errorMessage = error.message;
    //         // The email of the user's account used.
    //         var email = error.email;
    //         // The firebase.auth.AuthCredential type that was used.
    //         var credential = error.credential;
    //         // [START_EXCLUDE]
    //         if (errorCode === 'auth/account-exists-with-different-credential') {
    //           alert('You have already signed up with a different auth provider for that email.');
    //           // If you are using multiple auth providers on your app you should handle linking
    //           // the user's accounts here.
    //         } else {
    //           console.error(error);
    //         }
    //         // [END_EXCLUDE]
    //       });
    //       // [END authwithcred]
    //     } else {
    //       // window.location = 'graph.html';
    //       console.log('User already signed-in Firebase.');
    //     }
    //   });
    // }
    // [END googlecallback]


</script>

</body>
</html>

