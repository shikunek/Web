<html>
<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <meta name="google-signin-client_id" content="984038814608-l221clj0a3c05qaunenrm9oe9q3fvqif.apps.googleusercontent.com">
  <meta name="google-signin-cookiepolicy" content="single_host_origin">
  <meta name="google-signin-scope" content="profile email">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>


	<h1 id="B"></h1>

<!-- <header id="header">
  <div class="inner">
    <nav id="menubar">
    <ul id="menu">
        <li class="dropdown"><a href="#">Company</a></li>
        <li class="selected dropdown"><a href="#">Products</a></li>
        <li class="dropdown"><a href="#">News</a></li>
        <li class="dropdown"><a href="#">Downloads</a></li>
        <li><a href="#">Contact</a></li>
    </ul>
    </nav>
  </div>
</header> -->


<!-- <section id="graph">
  <img src="graph.png" alt="Browser GUI" width="600">

</section> -->
<div class="topnav">
  <div class='leftLink'>
    <a href="#" id='myGraphs'>My Graphs</a>  
  </div>

  <div class='rightLink'>
    <a href="#" onclick="document.getElementById('id01').style.display='block'" style="width:auto;">Login</a>
  </div>

  <div id="id01" class="modal">
  
    <form class="modal-content animate">
      <div class="imgcontainer">
        <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>     
      </div>

      <div class="container">
        <label for="uname"><b>Username</b></label>
        <input type="text" placeholder="Enter Username" name="uname" id="email" required>

        <label for="psw"><b>Password</b></label>
        <input type="password" placeholder="Enter Password" name="psw" id="psw" required>
          
        <button type="submit" id="signIn" onclick="login()">Login</button>
        <label>
          <input type="checkbox" checked="checked" name="remember"> Remember me
        </label>
      </div>
    </form>
  </div>
  
</div>

<div class="content">
  <h2>NudgeMe</h2>
  <p>A topnav, content and a footer.</p>
</div>

<!-- <div id="top">
    <div class="login">
        
        <div id="username">
          <label><b>Username</b></label>
          <input type="text" placeholder="Enter Username" id="email" required>
        </div>
        
        <div id="password">
          <label><b>Password</b></label>
          <input type="password" placeholder="Enter Password" id="psw" required>
        </div>
        
        <div id="loginButtons">
          <button type="submit" id="signIn" onClick="signIn()">Sign In</button>
          <button type="submit" id="siqnUp" onClick="signUp()">Sign Up</button>
        </div>
        <div class="g-signin2" data-onsuccess="onSignIn"></div>

        
    </div>

    </div>

</div> -->


<!-- <canvas id="myChart" width="400" height="400"></canvas> -->

<script src="https://apis.google.com/js/platform.js" async defer></script>

<script src="basicFunction.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-database.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyAR7L3KrsOWXYqu0HMcM85EOBPKWSOF9t0",
    authDomain: "testapp-5cce5.firebaseapp.com",
    databaseURL: "https://testapp-5cce5.firebaseio.com",
    projectId: "testapp-5cce5",
    storageBucket: "",
    messagingSenderId: "984038814608"
  };
  firebase.initializeApp(config);

  // var B = document.getElementById('B');
  // var dbref = firebase.database().ref().child('text');
  
  // dbref.on('value', snap => B.innerText = snap.val());
  // Get the modal
  var modal = document.getElementById('id01');

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
      if (event.target == modal) {
          modal.style.display = "none";
      }
  }

  var graphs = document.getElementById('myGraphs');
  graphs.onclick = function(event){
      firebase.auth().onAuthStateChanged(user => {
        if(user) {
          window.location = 'graph.html'; //After successful login, user will be redirected to home.html
        }
      });
  }

    function signUp() {

     var username = document.getElementById("email").value;
     var password = document.getElementById("psw").value;
     firebase.auth().createUserWithEmailAndPassword(username, password).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // [START_EXCLUDE]
        if (errorCode == 'auth/weak-password') {
          alert('The password is too weak.');
        } else {
          alert(errorMessage);
        }
        console.log(error);
        // [END_EXCLUDE]
      });

           //Handle Account Status
      firebase.auth().onAuthStateChanged(user => {
        if(user) {
          window.location = 'graph.html'; //After successful login, user will be redirected to home.html
        }
      });
    
  }

  function login() {

      document.getElementById('id01').style.display='none';
      if (firebase.auth().currentUser) {
        // [START signout]
        console.log(firebase.auth().currentUser.email);
        firebase.auth().signOut();
        // [END signout]
      } 
      {
        var email = document.getElementById('email').value;
        var password = document.getElementById('psw').value;
        if (email.length < 4) {
          alert('Please enter an email address.');
          return;
        }
        if (password.length < 4) {
          alert('Please enter a password.');
          return;
        }
        // Sign in with email and pass.
        // [START authwithemail]
        var result = firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // [START_EXCLUDE]
          if (errorCode === 'auth/wrong-password') {
            alert('Wrong password.');
          } else {
            alert(errorMessage);
          }
          console.log(error);
          

          // [END_EXCLUDE]
        });
        
        
        // [END authwithemail]
      }
      
      //Handle Account Status
      firebase.auth().onAuthStateChanged(user => {
        if(user) {
          // window.location = 'graph.html'; //After successful login, user will be redirected to home.html
        }
      });
      
    }

    function onSignIn(googleUser) {
      console.log('Google Auth Response', googleUser);
      // We need to register an Observer on Firebase Auth to make sure auth is initialized.
      var unsubscribe = firebase.auth().onAuthStateChanged(function(firebaseUser) {
        unsubscribe();
        // Check if we are already signed-in Firebase with the correct user.
        if (!isUserEqual(googleUser, firebaseUser)) {
          // Build Firebase credential with the Google ID token.
          // [START googlecredential]
          var credential = firebase.auth.GoogleAuthProvider.credential(
              googleUser.getAuthResponse().id_token);
          // [END googlecredential]
          // Sign in with credential from the Google user.
          // [START authwithcred]
          firebase.auth().signInWithCredential(credential).catch(function(error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // The email of the user's account used.
            var email = error.email;
            // The firebase.auth.AuthCredential type that was used.
            var credential = error.credential;
            // [START_EXCLUDE]
            if (errorCode === 'auth/account-exists-with-different-credential') {
              alert('You have already signed up with a different auth provider for that email.');
              // If you are using multiple auth providers on your app you should handle linking
              // the user's accounts here.
            } else {
              console.error(error);
            }
            // [END_EXCLUDE]
          });
          // [END authwithcred]
        } else {
          // window.location = 'graph.html';
          console.log('User already signed-in Firebase.');
        }
      });
    }
    // [END googlecallback]
    /**
     * Check that the given Google user is equals to the given Firebase user.
     */
    // [START checksameuser]
    function isUserEqual(googleUser, firebaseUser) {
      if (firebaseUser) {
        var providerData = firebaseUser.providerData;
        for (var i = 0; i < providerData.length; i++) {
          if (providerData[i].providerId === firebase.auth.GoogleAuthProvider.PROVIDER_ID &&
              providerData[i].uid === googleUser.getBasicProfile().getId()) {
            // We don't need to reauth the Firebase connection.
            return true;
          }
        }
      }
      return false;
    }

    // var table = document.getElementById("myTable");

    //   var newUserRef = firebase.database().ref('Users/');
    //   newUserRef.on('child_added', function(data) {
    //     console.log(data.val());
    //       var row = table.insertRow(0);
    //       var cell1 = row.insertCell(0);
    //       var cell2 = row.insertCell(1);
    //       cell1.innerHTML = data.val().name;
    //       cell2.innerHTML = data.val().age;
    //   });

  function addUsers()
  {
      
      var userName = document.getElementById("name").value;
      var userAge = document.getElementById("age").value;      

      var newID = firebase.database().ref().child('Users').push().key;
      var updates = {};
      var postData = {
                name : userName,
                age : userAge
              };
      updates['/Users/' + newID] = postData;

      firebase.database().ref().update(updates);


            //   firebase.database().ref("Users").update({
        //     [userName] : {
        //         age : userAge
        //       }
        // });

  }

  // function sendProgress()
  // {
      
  //     firebase.database().ref('/Progress/' + 'Petr').once('value').then(function(snapshot) {
  //       var old_X = snapshot.val().X;
  //       var new_X = parseInt($('input[name="gender"]:checked').val()) + parseInt(old_X);
  //       var newProgress = firebase.database().ref().child('Progress').push().key;
  //       var updates = {};
  //       var postData = {
  //                 X : new_X,
  //                 Y : new_X
  //               };
  //       updates['/Progress/' + 'Petr'] = postData;

  //       firebase.database().ref().update(updates);
  //     });
      
      
  // }

// var ctx = document.getElementById("myChart");

// var myLineChart = new Chart(ctx, {
//     type: 'line',
//     data: {
//             labels: ["January", "February", "March", "April", "May", "June", "July"],
//                       datasets: [{
//                           label: "My First dataset",
//                           backgroundColor: "red",
//                           borderColor: "red",
//                           data: [
//                               {
//                                   x: 10,
//                                   y: 20
//                               }, 
//                               {
//                                   x: 15,
//                                   y: 10
//                               },
//                               {
//                                   x: 20,
//                                   y: 15
//                               }
//                           ],

//                           fill: false,
//                         }]
//     },
//     options: {
//                 scales: {
//                     xAxes: [{
//                           ticks: {
//                               beginAtZero:true
//                           }
//                       }],
//                     yAxes: [{
//                         ticks: {
//                             beginAtZero:true
//                         }
//                     }]
//                 }
//             }
// });

// document.getElementById('addData').addEventListener('click', function() {
//             if (config.data.datasets.length > 0) {
//                 var month = MONTHS[config.data.labels.length % MONTHS.length];
//                 config.data.labels.push(month);

//                 config.data.datasets.forEach(function(dataset) {
//                     dataset.data.push(randomScalingFactor());
//                 });

//                 window.myLine.update();
//             }
//         });

// var myChart = new Chart(ctx, {
// type: 'bar',
// data: {
//     labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
//     datasets: [{
//         label: '# of Votes',
//         data: [12, 19, 3, 5, 2, 3],
//         backgroundColor: [
//             'rgba(255, 99, 132, 0.2)',
//             'rgba(54, 162, 235, 0.2)',
//             'rgba(255, 206, 86, 0.2)',
//             'rgba(75, 192, 192, 0.2)',
//             'rgba(153, 102, 255, 0.2)',
//             'rgba(255, 159, 64, 0.2)'
//         ],
//         borderColor: [
//             'rgba(255,99,132,1)',
//             'rgba(54, 162, 235, 1)',
//             'rgba(255, 206, 86, 1)',
//             'rgba(75, 192, 192, 1)',
//             'rgba(153, 102, 255, 1)',
//             'rgba(255, 159, 64, 1)'
//         ],
//         borderWidth: 1
//     }]
// },
// options: {
//     scales: {
//         yAxes: [{
//             ticks: {
//                 beginAtZero:true
//             }
//         }]
//     }
// }
// });


</script>
</body>
</html>